import{be as p,n as w,g as u,bf as T,a0 as E}from"./CvCKRdVv.js";import{u as c}from"./DiDv04eX.js";const S=p("auth",()=>{const a=w(),n=u(null),r=u(!1),i=u(!1),f=u(null),g=u(!1);async function y(t){var e;try{const{data:s,status:l,error:o}=await c("/api/auth/login",{method:"POST",body:t},"$X79xU4UTsj"),v=T().query.redirect_to||window.location.origin;if(l.value==="success"&&(console.log(v),n.value=(e=s.value)==null?void 0:e.user,r.value=!0,window.location.href=v),o.value){if(o.value.statusCode===422){const d=o.value.statusMessage;f.value=[d],a.notify({type:"negative",message:d,icon:"warning",timeout:3e3})}o.value.statusCode===401&&a.notify({type:"negative",message:o.value.statusMessage,icon:"warning",timeout:3e3})}}catch(s){console.log(s),a.notify({type:"negative",message:"An error occurred during login.",icon:"warning",timeout:3e3})}finally{i.value=!1}}async function h(){var t;if(!g.value)try{const{data:e,status:s,error:l}=await c("/api/auth/me",{method:"GET"},"$ut4CvpQmLF");if(s.value==="success"){n.value=(t=e.value)==null?void 0:t.user,r.value=!0;return}l.value&&a.notify({type:"negative",message:l.value.statusMessage,icon:"warning",timeout:3e3})}catch(e){console.error("Error fetching user data:",e)}finally{i.value=!1,g.value=!0}}async function m(){try{const{status:t,error:e}=await c("/api/auth/logout",{method:"POST"},"$OtQf28CjnM");t.value==="success"&&(n.value=null,r.value=!1,E("/auth/sigin")),e.value&&a.notify({type:"negative",message:e.value.statusMessage,icon:"warning",timeout:3e3})}catch(t){console.error("Error during logout:",t)}finally{i.value=!1}}return{user:n,isAuthenticated:r,loading:i,validationErrors:f,login:y,logout:m,fetchProfile:h}});export{S as u};
